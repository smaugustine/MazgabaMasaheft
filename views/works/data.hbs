<article id="work-data">
  <script id="xmlContent" type="text/xml">{{{xml}}}</script>
</article>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script>
  $(document).ready(function(){
    const xmlRequest = new XMLHttpRequest();
    const xsltProcessor = new XSLTProcessor();
    const domParser = new DOMParser();

    xmlRequest.open("GET", "/static/xsl/works/data.xsl", false);
    xmlRequest.send(null);
    const xslStylesheet = xmlRequest.responseXML;
    xsltProcessor.importStylesheet(xslStylesheet);

    const xmlDoc = domParser.parseFromString(document.getElementById('xmlContent').innerHTML, "text/xml");
    
    $('#work-data').html(xsltProcessor.transformToFragment(xmlDoc, document));

    $.getJSON("/static/json/editors.json", function(editors){
      $('span[data-initials]').each(function(){
        $(this).text(editors[$(this).attr('data-initials')]);
      });
    });

    $('time').each(function(){
      $(this).text(
        (new Date($(this).attr('datetime')).toLocaleDateString())
      );
    });
  });
</script>
